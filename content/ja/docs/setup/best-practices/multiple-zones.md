---
title: 複数のゾーンで動かす
weight: 20
content_type: concept
---

<!-- overview -->

このページでは、複数のゾーンでクラスターを実行する方法について説明します。

<!-- body -->

## 背景

Kubernetesは、1つのKubernetesクラスターが複数の障害ゾーンにまたがって実行できるように設計されており、通常、これらのゾーンはリージョンと呼ばれる論理的なグループ内に収まります。主要なクラウドプロバイダーは、一貫した機能を提供する障害ゾーン（アベイラビリティゾーンとも呼ばれる）の集合をリージョンと定義しており、リージョン内では各ゾーンが同じAPIとサービスを提供しています。

一般的なクラウドアーキテクチャは、あるゾーンで障害が発生した場合に、別のゾーンのサービスにも障害が発生する可能性を最小限に抑えることを目的としています。

## コントロールプレーンの動作

すべての[コントロールプレーンコンポーネント](/ja/docs/concepts/overview/components/#control-plane-components)は、コンポーネントごとに複製された、交換可能なリソースのプールとして動作することをサポートします。

クラスターコントロールプレーンをデプロイする場合は、複数の障害ゾーンに渡ってコントロールプレーンコンポーネントのレプリカを配置します。可用性を重視する場合は、少なくとも3つの障害ゾーンを選択し、個々のコントロールプレーンコンポーネント（APIサーバー、スケジューラー、etcd、クラスターコントローラーマネージャー）を少なくとも3つの障害ゾーンに渡って複製します。クラウドコントローラーマネージャーを実行している場合は、選択したすべての障害ゾーンにまたがって複製する必要があります。

{{< note >}}
KubernetesはAPIサーバーのエンドポイントに対してクロスゾーンの回復力を提供しません。クラスタAPIサーバーの可用性を向上させるためにDNSラウンドロビン、SRVレコード、またはヘルスチェックを備えたサードパーティのロードバランシングソリューションなど、さまざまな技術を使用できます。
{{< /note >}}

## ノードの動作

Kubernetesは、ワークロードリソース（{{< glossary_tooltip text="Deployment" term_id="deployment" >}}や{{< glossary_tooltip text="StatefulSet" term_id="statefulset" >}}のような）用のPodをクラスタ内の異なるノードに自動的に分散します。この分散は、障害の影響を軽減するのに役立ちます。

ノードが起動すると、各ノードのkubeletは、Kubernetes APIで特定のkubeletを表すノードオブジェクトに{{< glossary_tooltip text="ラベル" term_id="label" >}}を自動的に追加します。これらのラベルには[ゾーン情報](/docs/reference/labels-annotations-taints/#topologykubernetesiozone)を含めることができます。

クラスターが複数のゾーンまたはリージョンにまたがっている場合、ノードラベルと[Pod Topology Spread Constraints](/docs/concepts/scheduling-eviction/topology-spread-constraints/)を組み合わせて使用することで、リージョン、ゾーン、さらには特定のノードといった障害ドメイン間でクラスター全体にPodをどのように分散させるかを制御できます。これらのヒントにより、{{< glossary_tooltip text="scheduler" term_id="kube-scheduler" >}}は予想される可用性を高めてPodを配置し、相関する障害がワークロード全体に影響するリスクを低減できます。

たとえば、StatefulSetの3つのレプリカがすべて互いに異なるゾーンで実行されるように制約を設定できます。ワークロードごとにどのアベイラビリティゾーンを使用するかを明示的に定義しなくても、宣言的に定義できます。

### ノードをゾーンに分散させる

Kubernetesのコアがノードを作成してくれるわけではないため、自分で行うか、Cluster APIなどのツールを使ってノードの管理を代行する必要がある。

Cluster APIなどのツールを使用すると、複数の障害ドメインにわたってクラスターのワーカーノードとして実行するマシンのセットを定義したり、ゾーン全体のサービスが中断した場合にクラスターを自動的に復旧するルールを定義できる。



